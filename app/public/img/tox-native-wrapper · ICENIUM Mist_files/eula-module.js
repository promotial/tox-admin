define(function(f){var c=f("modules/core/dialog-viewmodels"),b=f("modules/core/dialog-service"),h=f("modules/user/user-identity-service"),d=f("text!./eula-dialog-template.html");f("css!./eula-dialog.css");var e=c.DialogViewModelBase.extend({isUserAgreed:false,eulaLink:"/eula.html?o=",init:function(){var i=this;i.eulaLink+=new Date().getTime();c.DialogViewModelBase.fn.init.apply(this,arguments)},onAcceptClicked:function(){var i=this;ice.server.authenticationService.agreeToEula().done(function(){i.dialog().destroy()}).fail(function(j){b.showMessageBox("Icenium | Server Error",j.serverError)})},onClose:function(i){if(i){i.preventDefault()}}});function a(i){if(!i.eula&&i.tenant!==undefined){g()}}function g(){var j,i;j=new e();i={template:d,viewModel:j,height:document.body.offsetHeight?(document.body.offsetHeight*0.7)+"px":"500px",refresh:function(){this.center()},className:"above-progress eula-dialog"};b.showModalDialog("End User License Agreement",i)}h.getInitPromise().done(function(){a(h.userInfo)})});