define(function(c){var d=c("modules/core/rest-proxy"),b=c("modules/logging/logging-service"),e=d.init(window.location.host,serviceConfiguration.backendServiceScheme);var a=window;var f=kendo.Observable.extend({SETTINGS_FILE_PATH:"user-settings.xml",SETTING_TRACK_FEATURE_USAGE:"TrackFeatureUsage",SETTINGS_DEFAULT_TEMPLATE:'<JustDevelopSettings><AnalyticsSettings xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><TrackFeatureUsage>true</TrackFeatureUsage></AnalyticsSettings></JustDevelopSettings>',USER_SETTINGS_INIT_MSG:"Loading user settings...",init:function(){var g=this;kendo.Observable.fn.init.apply(this,arguments);g._deferred=$.Deferred()},promise:function(){return this._deferred.promise()},requestSettings:function(){var g=this;e.fileSystemService.getContent({path:g.SETTINGS_FILE_PATH}).done($.proxy(g.onDataReceived,g)).fail($.proxy(g.onDataError,g))},onDataError:function(g){var h=this;if(g.status===404){h._settingsXml=$($.parseXML(h.SETTINGS_DEFAULT_TEMPLATE));h.isModified=false;h.isLoading=false;h._deferred.resolve()}else{this._deferred.reject()}},onDataReceived:function(g){var i=this;try{if(typeof g==="object"){i._settingsXml=$(g)}else{i._settingsXml=$($.parseXML(g))}i.isModified=false;i.isLoading=false;i._deferred.resolve()}catch(h){i._deferred.reject()}},getSettings:function(h){var i=this;if(i._settingsXml){var g=i._settingsXml.find(h);if(g){return g.text()}}},setSettings:function(h,j){var i=this;if(i._settingsXml){var g=i._settingsXml.find(h);if(g&&g.text()!==j){g.text(j);i.isModified=true;i.trigger(a.USER_SETTINGS_CHANGE,{key:h,value:j})}}i.save()},save:function(){var g=this;if(g._settingsXml&&g.isModified){var h=g._settingsXml,i=h.xml?h.xml:(new XMLSerializer()).serializeToString(h[0]);e.fileSystemService.save({path:g.SETTINGS_FILE_PATH,content:i,validatorTypeName:""}).fail($.proxy(g.onSaveError,g))}},onSaveError:function(g){b.logOutputMessage("Settings save error"+(g.responseText||g))},isModified:false,isLoading:true});return new f()});