define(function(d){var b,a=d("kendo");var c=a.Observable.extend({_gitHubDummyEndpoint:"https://api.github.com/user",_gitHubRepoEndpoint:"https://api.github.com/user/repos",_prefixsessionStorage:"Icenium",providers:["github","bitbucket"],init:function(){var e=this;a.Observable.fn.init.apply(e,arguments)},_getSessionStorageKey:function(e){var f=this;return[f._prefixsessionStorage,"bt"].join("")},storeCredentials:function(f,e){var h=this,g=h._getSessionStorageKey(f);sessionStorage.setItem(g,e)},isUserAuthenticated:function(g){var i=this,h=i._getSessionStorageKey(g),e=sessionStorage.getItem(h),f=new $.Deferred();if(e!==null){i.validateCredentials(g,e).done(function(j){f.resolve(j)}).fail(function(){f.reject(false)})}return f.promise()},validateCredentials:function(g,e){var h=this,f=new $.Deferred();switch(g){case"github":h.validateGitHubCredentials(e).done(function(i){f.resolve(i)}).fail(function(){f.reject(false)});break;default:f.resolve(false)}return f.promise()},validateGitUrl:function(f){var g=this,e=new $.Deferred();$.ajax({url:f,type:"get"}).done(function(h){if(h){e.resolve(true)}e.reject(false)}).fail(function(h){e.reject(false)});return e.promise()},validateGitHubCredentials:function(e){var g=this,f=new $.Deferred(),h=g._gitHubDummyEndpoint;$.ajax({url:h,type:"get",beforeSend:function(i){i.setRequestHeader("Authorization",["Basic",e].join(" "))}}).done(function(i){if(i){g.gitHubCredentials=e;f.resolve(true)}f.reject(false)}).fail(function(i){f.reject(false)});return f.promise()},_getGitHubCredentials:function(){var g=this,f=g._getSessionStorageKey("github"),e=sessionStorage.getItem(f);if(e){return e}return g.gitHubCredentials},createGitHubRepo:function(h,g,i){var j=this,k=j._gitHubRepoEndpoint,e=new $.Deferred(),f=JSON.stringify({name:h,description:g,"private":i});$.ajax({url:k,dataType:"json",type:"post",data:f,beforeSend:function(l){l.setRequestHeader("Authorization",["Basic",j._getGitHubCredentials()].join(" "))}}).done(function(l){if(l){e.resolve({cloneUrl:l.clone_url,inviteCollaboratorsUrl:j._generateInviteCollaboratorsUrl(l.html_url)})}else{e.reject("Failed to create repository.")}}).fail(function(l){var m,n=["Provider error:"];response=JSON.parse(l.responseText);for(m=0,errorsCount=response.errors.length;m<errorsCount;m++){n.push(response.errors[m].message+".")}e.reject(n.join(" "))});return e.promise()},getGitHubRepositories:function(){var f=this,g=f._gitHubRepoEndpoint,e=new $.Deferred();$.ajax({url:g,type:"get",beforeSend:function(h){h.setRequestHeader("Authorization",["Basic",f._getGitHubCredentials()].join(" "))}}).done(function(k){var l=[];if(k&&k.length){for(var i=0,j=k.length;i<j;i++){var h=k[i];l.push({name:h.name,"private":h["private"]===true?"private":"public",cloneUrl:h.clone_url,inviteCollaboratorsUrl:f._generateInviteCollaboratorsUrl(h.html_url)})}e.resolve(l)}e.reject("No repositories found.")}).fail(function(h){e.reject("Failed to retreve user repo list.")});return e.promise()},_generateInviteCollaboratorsUrl:function(e){return[e,"settings/collaboration"].join("/")}});b=new c();return b});