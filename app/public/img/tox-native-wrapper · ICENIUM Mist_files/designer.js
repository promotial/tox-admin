(function(a,o){var g=window.kendo,m=window.tools,n=g.ui,h=g.Observable,k=a.proxy,d=a.extend,l="<script>    if (!window.kendo.mobile.ui.Button.prototype.badge) {         window.parent.postMessage(JSON.stringify({ old_kendo: true }), '*');         try { window.onerror = function (message) { return false; }; } catch(e) {}        kendo.mobile.Application.prototype.init = function () {};    }</script>",f="k-state-hidden",i={iphone:"Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Mobile/10A5376e",ipad:"Mozilla/5.0 (iPad; CPU OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5355d Safari/8536.25",android:"Mozilla/5.0 (Linux; Android 4.2; Nexus 4 Build/JVP15Q) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Mobile Safari/535.19",nexus7:"Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19",blackberry:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/10.0.9.2372 Mobile Safari/537.10+",playbook:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML, like Gecko) Version/7.2.1.0 Safari/536.2+"},e={css:{mime:"text/css",template:'<link href="#=data.filename#" rel="stylesheet" type="text/css">'},js:{mime:"text/javascript",template:'<script src="#=data.filename#" type="text/javascript"></script>'}},j=["styles/preview.css","scripts/tools.js","scripts/framereceiver.js","scripts/previewcontroller.js"],b=function(){var t=this,p=t.frameElement,q=t.leftPane.element,s=t.rightPane.element,u=a(".editorWrapper"),r=t.leftPane.content;if(t.editor){u.toggleClass(f,window.innerWidth<=p.outerWidth(true)+(t.editor?u.outerWidth(true):0)+100)}q.toggleClass(f,window.innerWidth<=p.outerWidth(true)+r.outerWidth(true)+(t.editor&&!u.hasClass(f)?u.outerWidth(true):0)+100);s.toggleClass(f,window.innerWidth<=p.outerWidth(true)+r.outerWidth(true)+t.rightPane.content.outerWidth(true)+(t.editor&&!u.hasClass(f)?u.outerWidth(true):0)+100)},c=h.extend({init:function(q){var s=this,t,r,p=k(b,s),v=a("#widgetList"),u;h.fn.init.call(this);g.mobile.application={os:{name:"ios"},element:a(document.body)};s.frameElement=a("#frame");s.options=d(true,{},s.options,q);if(s.options.base){s.base=s.options.base}else{s.base=window.location.href.replace(/#.*/,"");s.base=s.base.substr(0,s.base.lastIndexOf("/")+1)}s.currentOS="iphone";s.prerequisites={};s._osChangeProxy=k(s.osChange,s);s._updateProxy=k(s.updatePreview,s);s._triggerProxy=k(s._triggerWidgetList,s);if(v[0]){m.cleanTree(v[0]);u=v.kendoPanelBar({expand:s._triggerProxy,collapse:s._triggerProxy,dataSource:window.designer.widgetItems,animation:{expand:{effects:"expand:vertical slideIn:down"}}}).data("kendoPanelBar");u.element.find(".widget").each(function(){var x=a(this),w=x.text().toLowerCase(),y=window.designer.widgets[w];x.attr("data-name",w);x.find(".k-link").text(y.label||y.name)})}if(n.Dock){s.leftPane=a("#leftPane").kendoDock().data("kendoDock");s.rightPane=a("#rightPane").kendoDock({position:"end"}).data("kendoDock");p();a(window).on("resize",p)}if(n.ImageManager){s.imageManager=a(document.documentElement).kendoImageManager({filter:".k-image-window",store:window.designer.store}).data("kendoImageManager")}if(n.PropertyInspector){s.inspector=a("#inspector").kendoPropertyInspector({designer:s}).data("kendoPropertyInspector")}if(n.CodeManager){s.codeManager=new n.CodeManager(null,{designer:s})}if(n.DesignEditor){s.editor=a("#codeView").kendoDesignEditor({designer:s}).data("kendoDesignEditor")}a(".phone-selector").on("click",s._osChangeProxy);s.targetWindow=s.frameElement[0].contentWindow;s.adapter=s.frameElement.kendoFrameAdapter({designer:s,dragFilter:u?u.element.find(".widget"):a(),init:s.editor?s.editor._selectWidgetAtCursorProxy:a.noop}).data("kendoFrameAdapter");j.forEach(function(w){a.get(s.base+w,function(x){t=w.substr(w.lastIndexOf(".")+1);s.prerequisites[w]={type:t,template:g.template(e[t].template,{usedWithBlock:false}),url:window.URL.createObjectURL(new Blob([x],{type:e[t].mime}))};if(g.size(s.prerequisites)==j.length){j.forEach(function(y){r=s.prerequisites[y];l+=r.template({filename:r.url})});l+='<script>window.preview = $(document.documentElement).kendoPreviewController({ receiver: new kendo.ui.FrameReceiver({ domain: "'+s.base+'" }) }).data("kendoPreviewController");</script>';document.dispatchEvent(new window.CustomEvent("KendoMobileDesignerInit",{}))}})});document.documentElement.addEventListener("keydown",function(w){s.trigger("keypress",{keyCode:event.keyCode,charCode:event.charCode,which:event.which,ctrlKey:event.ctrlKey,shiftKey:event.shiftKey,altKey:event.altKey,metaKey:event.metaKey});if((w.keyCode==79||w.keyCode==83)&&w.ctrlKey){w.preventDefault()}},true)},options:{base:""},events:["init","change","select"],select:function(p){this.codeManager.selectAtPos(p)},feed:function(q,p){var r=this;if(p){r.base=p}r.codeManager.feed(q)},isUpdateScheduled:function(){return this.updateDelay>0},scheduleUpdate:function(){var p=this;if(!p.suppress){p.cancelUpdate();p.updateDelay=setTimeout(p._updateProxy,1000)}p.suppress=false},cancelUpdate:function(){clearTimeout(this.updateDelay);this.updateDelay=0},reSchedule:function(){var p=this;if(p.isUpdateScheduled()){p.cancelUpdate();p.updateDelay=setTimeout(p._updateProxy,1000)}},getContent:function(){var q=this,p=q.codeManager.getContent().replace(/(kendo[^>\/]*?\.js[^>]+?(>\s*?<\/script\s*?>|\/>))/im,"$1\n"+l)+"<script>    if (!window.kendo || !window.kendo.mobile) {         window.parent.postMessage(JSON.stringify({ no_kendo: true }), '*');     } else {        $(function() { setTimeout(function () {             if (!window.kendo.mobile.application) {                viewModel = window.viewModel || {};                 (function () {                    var layout = $(kendo.roleSelector('layout'))[0];                    new kendo.mobile.Application(null, { layout: layout ? layout.dataset.id : null });                })();            }        }, 200); });    }</script>";if(q.base){p=p.replace(/(<head\b.*?>)/igm,"$1\n<base href='"+q.base+"' /><script>try{ window.onerror = function (message) { if (/kendo/.test(message)) { window.parent.postMessage(JSON.stringify({ no_kendo: true }), '*'); } return false; }; }catch(e){}if(navigator.__defineGetter__){navigator.__defineGetter__('userAgent',function(){return'"+i[q.currentOS]+"';});}</script>")}return p},updatePreview:function(){var r=this,q=document.getElementById("frame"),p=q.contentDocument||q.contentWindow.document;r.updateDelay=0;if(r.codeManager.hasErrors()){r.frameElement[0].src="about:blank";r.codeManager.errors=true;a("#box").addClass("disabled message").removeClass("warning");a(".errorMessage").css({height:"200px",marginTop:"-100px"}).find(".content").text("The Icenium Designer View requires your HTML5 document to be valid. Preview disabled.").end().find(".message").html(r.codeManager.errorMessage);return}if(window.URL){q.src=window.URL.createObjectURL(new Blob([r.getContent()],{type:"text/html"}))}else{p.open();p.write(r.getContent());p.close()}},suppressUpdate:function(){this.suppress=true},insertWidget:function(p,r){var s=this,q;s.suppressUpdate();if((q=s.codeManager.insertCode(p,r))!==null){s.adapter.send(q)}},osChange:function(p){var r=this,q=a(p.target);if(!q.hasClass("selected")){q.siblings().removeClass("selected");r.currentOS=p.target.className.replace(" phone-selector","");q.addClass("selected");setTimeout(function(){r.updatePreview()},200)}},_triggerWidgetList:function(p){var r=a(p.item);window.designer.widgetListState[r.children(".k-link").text()]=!r.is(".k-state-active");if(localStorage){try{localStorage.setItem("widgetListState",JSON.stringify(window.designer.widgetListState))}catch(q){}}}});window.UIDesigner=c;a(function(){window.designer=d(true,new c(),window.designer)})})(jQuery);