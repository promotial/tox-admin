(function(){var a=CodeMirror.Pos;function b(d,g,f,c){this.atOccurrence=false;this.doc=d;if(c==null&&typeof g=="string"){c=false}f=f?d.clipPos(f):a(0,0);this.pos={from:f,to:f};if(typeof g!="string"){if(!g.global){g=new RegExp(g.source,g.ignoreCase?"ig":"g")}this.matches=function(o,n){if(o){g.lastIndex=0;var j=d.getLine(n.line).slice(0,n.ch),i=0,k,p;for(;;){g.lastIndex=i;var m=g.exec(j);if(!m){break}k=m;p=k.index;i=k.index+(k[0].length||1);if(i==j.length){break}}var l=(k&&k[0].length)||0;if(!l){if(p==0&&j.length==0){k=undefined}else{if(p!=d.getLine(n.line).length){l++}}}}else{g.lastIndex=n.ch;var j=d.getLine(n.line),k=g.exec(j);var l=(k&&k[0].length)||0;var p=k&&k.index;if(p+l!=j.length&&!l){l=1}}if(k&&l){return{from:a(n.line,p),to:a(n.line,p+l),match:k}}}}else{if(c){g=g.toLowerCase()}var e=c?function(i){return i.toLowerCase()}:function(i){return i};var h=g.split("\n");if(h.length==1){if(!g.length){this.matches=function(){}}else{this.matches=function(m,l){var j=e(d.getLine(l.line)),i=g.length,k;if(m?(l.ch>=i&&(k=j.lastIndexOf(g,l.ch-i))!=-1):(k=j.indexOf(g,l.ch))!=-1){return{from:a(l.line,k),to:a(l.line,k+i)}}}}}else{this.matches=function(q,p){var l=p.line,j=(q?h.length-1:0),m=h[j],k=e(d.getLine(l));var n=(q?k.indexOf(m)+m.length:k.lastIndexOf(m));if(q?n>=p.ch||n!=m.length:n<=p.ch||n!=k.length-m.length){return}for(;;){if(q?!l:l==d.lineCount()-1){return}k=e(d.getLine(l+=q?-1:1));m=h[q?--j:++j];if(j>0&&j<h.length-1){if(k!=m){return}else{continue}}var o=(q?k.lastIndexOf(m):k.indexOf(m)+m.length);if(q?o!=k.length-m.length:o!=m.length){return}var r=a(p.line,n),i=a(l,o);return{from:q?i:r,to:q?r:i}}}}}}b.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var g=this,d=this.doc.clipPos(e?this.pos.from:this.pos.to);function f(h){var i=a(h,0);g.pos={from:i,to:i};g.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(e,d)){if(!this.pos.from||!this.pos.to){console.log(this.matches,this.pos)}this.atOccurrence=true;return this.pos.match||true}if(e){if(!d.line){return f(0)}d=a(d.line-1,this.doc.getLine(d.line-1).length)}else{var c=this.doc.lineCount();if(d.line==c-1){return f(c)}d=a(d.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(d){if(!this.atOccurrence){return}var c=CodeMirror.splitLines(d);this.doc.replaceRange(c,this.pos.from,this.pos.to);this.pos.to=a(this.pos.from.line+c.length-1,c[c.length-1].length+(c.length==1?this.pos.from.ch:0))}};CodeMirror.defineExtension("getSearchCursor",function(e,d,c){return new b(this.doc,e,d,c)});CodeMirror.defineDocExtension("getSearchCursor",function(e,d,c){return new b(this,e,d,c)})})();