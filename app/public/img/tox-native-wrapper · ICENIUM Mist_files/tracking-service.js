define(function(d){var c=d("kendo"),g=d("modules/core/user-settings-service"),b=d("modules/core/data-loss-protection-service"),f=d("modules/user/user-identity-service");d("js!noamd/EqatecMonitor.min.js");var a=window;var e=c.Observable.extend({STORE_KEY:"local-settings-TrackFeatureUsage",enabled:false,init:function(){var h=this;if(localStorage){h.enabled=(localStorage.getItem(h.STORE_KEY)==="true")}c.Observable.fn.init.apply(h,arguments);g.bind(a.USER_SETTINGS_CHANGE,$.proxy(h.onUserSettingsChange,h));b.bind(a.APP_UNLOAD,$.proxy(h.onAplicationUnload,h));g.promise().done(function(){h.updateTrackFeaturesOption();h.toggleMonitor()})},isTrackingEnabled:function(){var h=this;return h.enabled},isTrackingActive:function(){var h=this;return(h.monitor!==undefined&&h.monitor!==null)},toggleMonitor:function(){var h=this;if(h.isTrackingActive()&&!h.isTrackingEnabled()){h.monitor.stop();h.monitor=null}if(!h.isTrackingActive()&&h.isTrackingEnabled()){h.initializeEqatec()}},initializeEqatec:function(){var j=this,h=serviceConfiguration.eqatecProductId,i=_eqatec.createSettings(h);i.version=serviceConfiguration.assemblyVersion;j.monitor=_eqatec.createMonitor(i);f.getInitPromise().done(function(k){j.monitor.setInstallationID(iceConfiguration.loggedUser);j.monitor.setUserID(k.email);j.monitor.start()})},onAplicationUnload:function(){var h=this;if(h.isTrackingActive()){h.monitor.stop()}},onUserSettingsChange:function(){var h=this;h.updateTrackFeaturesOption();h.toggleMonitor()},updateTrackFeaturesOption:function(){var i=this,h=g.getSettings(g.SETTING_TRACK_FEATURE_USAGE);i.enabled=(h===undefined||h==="true");if(localStorage){localStorage.setItem(i.STORE_KEY,i.enabled.toString())}},logCommand:function(h){var i=[];if(h.regionName!==undefined){i.push(h.regionName)}if(h.trigger!==undefined){i.push(h.trigger)}this.logEvent("Mist-Command",h.id,i.join("-"))},logEvent:function(h,i){var j=this;if(!j.isTrackingActive()){return}if(!h||!i){return}j.monitor.trackFeature([h,i].join("."))},logException:function(h,j){var l=this,i=navigator.onLine;if(!l.isTrackingActive()){return}if(!i){j="[Offline] "+j}var k="";if(iceConfiguration&&iceConfiguration.solutionName!==undefined){k=iceConfiguration.solutionName}if(k!==""){j="["+k+"] "+j}l.monitor.trackException(h,j)},trackMethods:function(k){var l=this;function m(p,n,o){return function(){var q=p.apply(this,arguments);l.logEvent(n,o);return q}}for(var j in k){if(typeof k[j]==="function"){var i=k[j],h=i.attribute();if(h!==undefined&&h.track!==undefined){k[j]=m(i,h.track.featureCategory||"Method",h.track.featureName||j)}}}}});return new e()});