(function(){function n(p){if(typeof p=="string"){return{token:function(q){if(q.match(p)){return"searching"}q.next();q.skipTo(p.charAt(0))||q.skipToEnd()}}}return{token:function(q){if(q.match(p)){return"searching"}while(!q.eol()){q.next();if(q.match(p,false)){break}}}}}function o(){this.posFrom=this.posTo=this.query=null;this.overlay=null}function h(p){return p.state.search||(p.state.search=new o())}function g(p,r,q){return p.getSearchCursor(r,q,typeof r=="string"&&r==r.toLowerCase())}function c(p,s,r,q){if(p.openDialog){p.openDialog(s,q)}else{q(prompt(r,""))}}function b(p,s,r,q){if(p.openConfirm){p.openConfirm(s,q)}else{if(confirm(r)){q[0]()}}}function i(q){var p=q.match(/^\/(.*)\/([a-z]*)$/);return p?new RegExp(p[1],p[2].indexOf("i")==-1?"":"i"):q}var j='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';function e(p,q){var r=h(p);if(r.query){return f(p,q)}c(p,j,"Search for:",function(s){p.operation(function(){if(!s||r.query){return}r.query=i(s);p.removeOverlay(r.overlay);r.overlay=n(r.query);p.addOverlay(r.overlay);r.posFrom=r.posTo=p.getCursor();f(p,q)})})}function f(p,q){p.operation(function(){var s=h(p);var r=g(p,s.query,q?s.posFrom:s.posTo);if(!r.find(q)){r=g(p,s.query,q?CodeMirror.Pos(p.lastLine()):CodeMirror.Pos(p.firstLine(),0));if(!r.find(q)){return}}p.setSelection(r.from(),r.to());s.posFrom=r.from();s.posTo=r.to()})}function a(p){p.operation(function(){var q=h(p);if(!q.query){return}q.query=null;p.removeOverlay(q.overlay)})}var m='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';var l='With: <input type="text" style="width: 10em"/>';var d="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function k(q,p){c(q,m,"Replace:",function(r){if(!r){return}r=i(r);c(q,l,"Replace with:",function(v){if(p){q.operation(function(){for(var w=g(q,r);w.findNext();){if(typeof r!="string"){var x=q.getRange(w.from(),w.to()).match(r);w.replace(v.replace(/\$(\d)/,function(y,z){return x[z]}))}else{w.replace(v)}}})}else{a(q);var t=g(q,r,q.getCursor());var s=function(){var x=t.from(),w;if(!(w=t.findNext())){t=g(q,r);if(!(w=t.findNext())||(x&&t.from().line==x.line&&t.from().ch==x.ch)){return}}q.setSelection(t.from(),t.to());b(q,d,"Replace?",[function(){u(w)},s])};var u=function(w){t.replace(typeof r=="string"?v:v.replace(/\$(\d)/,function(x,y){return w[y]}));s()};s()}})})}CodeMirror.commands.find=function(p){a(p);e(p)};CodeMirror.commands.findNext=e;CodeMirror.commands.findPrev=function(p){e(p,true)};CodeMirror.commands.clearSearch=a;CodeMirror.commands.replace=k;CodeMirror.commands.replaceAll=function(p){k(p,true)}})();