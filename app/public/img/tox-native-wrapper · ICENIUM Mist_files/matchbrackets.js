(function(){var d=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var g=CodeMirror.Pos;var f={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function c(h,z,x){var w=h.state.matchBrackets;var r=(w&&w.maxScanLineLength)||10000;var j=z||h.getCursor(),p=h.getLineHandle(j.line),s=j.ch-1;var q=(s>=0&&f[p.text.charAt(s)])||f[p.text.charAt(++s)];if(!q){return null}var m=q.charAt(1)==">",k=m?1:-1;if(x&&m!=(s==j.ch)){return null}var y=h.getTokenTypeAt(g(j.line,s+1));var v=[p.text.charAt(s)],t=/[(){}[\]]/;function u(B,C,F){if(!B.text){return}var E=m?0:B.text.length-1,A=m?B.text.length:-1;if(B.text.length>r){return null}if(F!=null){E=F+k}for(;E!=A;E+=k){var i=B.text.charAt(E);if(t.test(i)&&h.getTokenTypeAt(g(C,E+1))==y){var D=f[i];if(D.charAt(1)==">"==m){v.push(i)}else{if(v.pop()!=D.charAt(0)){return{pos:E,match:false}}else{if(!v.length){return{pos:E,match:true}}}}}}}for(var o=j.line,n,l=m?Math.min(o+100,h.lineCount()):Math.max(-1,o-100);o!=l;o+=k){if(o==j.line){n=u(p,o,s)}else{n=u(h.getLineHandle(o),o)}if(n){break}}return{from:g(j.line,s),to:n&&g(o,n.pos),match:n&&n.match,forward:m}}function e(j,h){var l=j.state.matchBrackets.maxHighlightLineLength||1000;var k=c(j);if(!k||j.getLine(k.from.line).length>l||k.to&&j.getLine(k.to.line).length>l){return}var n=k.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var m=j.markText(k.from,g(k.from.line,k.from.ch+1),{className:n});var o=k.to&&j.markText(k.to,g(k.to.line,k.to.ch+1),{className:n});if(d&&j.state.focused){j.display.input.focus()}var i=function(){j.operation(function(){m.clear();o&&o.clear()})};if(h){setTimeout(i,800)}else{return i}}var a=null;function b(h){h.operation(function(){if(a){a();a=null}if(!h.somethingSelected()){a=e(h,false)}})}CodeMirror.defineOption("matchBrackets",false,function(h,j,i){if(i&&i!=CodeMirror.Init){h.off("cursorActivity",b)}if(j){h.state.matchBrackets=typeof j=="object"?j:{};h.on("cursorActivity",b)}});CodeMirror.defineExtension("matchBrackets",function(){e(this,true)});CodeMirror.defineExtension("findMatchingBracket",function(h,i){return c(this,h,i)})})();