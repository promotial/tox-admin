define(function(g){var d=g("text!./../../duplex.json"),h=new $.Deferred(),c=null;g(["js!../../noamd/jquery.signalR.js"],function(){h.resolve()});if(typeof d==="string"){d=JSON.parse(d)}function b(i){return i.substring(0,1).toLowerCase()+i.substring(1)}function e(l,i){var m=i||"https",k=m+"://"+l,j=k+"/";return f(j)}function f(k,m){if(c!==null){return c}c=m||{};for(var n=0;n<d.length;n++){var l=d[n],q=b(l.name.replace(/I(\w*)Contract/,"$1")),p=c[q]||{};c[q]=p;for(var o=0;o<l.sessions.length;o++){var r=l.sessions[o],s=b(r.factoryMethodName);p[s]=a(r,k)}}return c}function a(k,i){function j(){var C=this,o=null,m={},s=[];function q(l){o=$.connection(l);o.received(function(F){var D=JSON.parse(F);if(D.OperationId!==undefined){if(D.OperationId===0){s[D.OperationId].resolve()}else{if(D.Result!==undefined){s[D.OperationId].resolve(D.Result)}else{if(D.Exception!==undefined){s[D.OperationId].reject(D.Exception)}else{if(D.MethodName!==undefined){if(m[D.MethodName]!==undefined){var G=m[D.MethodName].call(C,D.Arguments),E={OperationId:D.OperationId};if(G!==undefined&&G.done!==undefined){G.done(function(H){E.Result=H;o.send(JSON.stringify(E))}).fail(function(H){E.Canceled=H;o.send(JSON.stringify(E));C.stop()})}else{if(G!==undefined){E.Result=G;o.send(JSON.stringify(E))}}}else{if(C.client[D.MethodName]!==undefined){throw"Not implemented callback: "+C.client[D.MethodName].definition}else{throw"Missing duplex definition"}}}else{throw"SignalR: unexpected response"+JSON.stringify(D)}}}}}else{throw"SignalR: No Operation Id"}}).error(function(D){throw"SignalR: Transport error"})}function t(E,l,H){var D=H||new $.Deferred(),G=s.length,F={MethodName:E,OperationId:G,Arguments:l||{}};s.push(D);o.send(JSON.stringify(F));return D.promise()}function r(D,l){m[D]=l}C.start=function(l){var D=new $.Deferred();if(o!==null){throw"Connection is already started"}h.then(function(){q(i+k.endpoint);o.start({transport:"longPolling"}).done(function(){t(k.factoryMethodName,l,D)}).fail(function(E){C.stop();D.reject(E)})});return D.promise()};C.stop=function(){if(o!==null){o.stop()}o=null;m={};s=[]};C.server={};C.client={};function u(l,D){return function(E){return t(l,E)}}function n(l){return function(D){r(l,D);return C.client}}function p(l,D){return[l,"({ ",$.map(D,function(E){return E.name+" : "+E.type.replace("Telerik.BlackDragon.Common.Data.")}).join(", ")," })"].join("")}for(var w=0,z=k.methods.length;w<z;w++){var A=k.methods[w].name,B=k.methods[w].parameters;C.server[b(A)]=u(A,B)}for(var x=0,y=k.callbackMethods.length;x<y;x++){var v=b(k.callbackMethods[x].name);C.client[v]=n(k.callbackMethods[x].name);C.client[v].definition=p(v,k.callbackMethods[x].parameters)}}return new j()}return{init:e,initByUrl:f,duplex:c}});