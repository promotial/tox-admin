(function(a,i){var d=window.kendo,g=window.tools,h=d.ui,e=d.mobile.ui,j=h.Widget,f=a.proxy,b=a.extend,k={navbar:{leftitem:{top:0,left:0,width:"33%",height:"100%",action:"prepend"},rightitem:{top:0,width:"33%",right:0,height:"100%",action:"prepend"},"view-title":{top:0,left:"33%",width:"33%",height:"100%"}},view:{header:{top:0,left:0,height:"40px",width:"100%"},footer:{left:0,height:"40px",bottom:0,width:"100%"}}},c=j.extend({init:function(n,o){var p=this;j.fn.init.call(p,n,o);o=p.options;n=p.element;p.domain=o.domain||"*";window.addEventListener("message",f(p._onMessage,p),false);if(n[0]){p.overlay=a("<div class='k-frame-overlay' />").css({width:n.outerWidth(),height:n.outerHeight(),top:n.position().top,left:n.position().left,display:"none"}).insertAfter(n);p._initWidgets()}if(o.dragFilter){var m=null,l={left:0,top:0};o.dragFilter.kendoDraggable({cursorOffset:{left:20,top:20},hint:function(r){var u=r.data("name"),v=u.toLowerCase(),x,z="kendoMobile"+u,q=p.frameInfo.init.application,y=window.designer.widgets[v],t=p.getWidgetMarkup(u),s,A,w=(q.options.platform||q.os.name);p.signature={id:window.designer.codeManager.getWidgetId(u+"Widget"),tag:t.markup.match(/^<(\w+?)\b/)[1],originalName:v,name:z,autoId:y.autoId,markup:t.markup,holder:y.holder,render:y.render,options:y.options,whitelist:y.whitelist,blacklist:y.blacklist,constrain:y.constrain,zones:y.zones,action:y.action,mutations:y.mutations,exclusions:y.exclusions,inclusions:y.inclusions,preferLayout:y.preferLayout};s=a(t.hint);x=s.wrapAll('<div class="km-root hint km-'+w+'"><div class="km-pane km-list km-'+w+'"><div class="km-content"></div></div></div>').parent().parent().parent().css({width:p.overlay.width(),height:"auto"}).appendTo(document.body);A=a('<div data-role="pane"></div>').data("kendoMobilePane",{bind:a.noop,element:x});x.wrap(A);d.init(x,e);x.unwrap();p.widget=d.widgetInstance(s,e);if(p.widget&&p.widget.refresh){p.widget.refresh({view:{id:"",options:{},element:{attr:a.noop}}})}return x},dragstart:function(){var q=p.element;p.send({zonate:{zones:k,widgetZones:p.signature.zones}});p.overlay.css({top:q.position().top,left:q.position().left}).show()},drag:function(q){if(q.timeStamp%5&&d.support.browser.msie){return}if(m&&m.hasClass("k-frame-overlay")){var r=p.element[0].contentWindow,s=b({page:q.x.client-l.left},q.x),t=b({page:q.y.client-l.top},q.y);p.overlay.hide();r.preview._getElement(s.page,t.page);p.overlay.show();p.send({drag:{x:s,y:t,signature:p.signature}})}},dragend:function(){if(m&&m.hasClass("k-frame-overlay")){p.send({drop:{signature:p.signature}})}else{p.send({destroy:true})}if(p.widget){p.widget.element.remove();p.widget.destroy()}p.overlay.hide();m=null}});p.overlay.kendoDropTarget({dragenter:function(q){m=q.dropTarget;l=m.offset()},dragleave:function(){m=null},drop:function(){}})}p.bind(p.events,p.options);p.bind("dropped",function(q){var t=this,r=/km-\w+?(?:\s|$)/i.exec(q.refClass),s=t.signature;if(r){s.markup=t.getWidgetMarkup(s.originalName,r[0]).markup}if(q.setId){s.markup=s.markup.replace(/(<\w+\b)/,"$1 "+s.autoId+'="'+q.setId+'"')}window.designer.insertWidget(q,s)});p.bind("init",function(){a("#box").removeClass("disabled error message")});p.bind("no_kendo",function(){window.designer.frameElement[0].src="about:blank";window.designer.codeManager.errors=true;a("#box").addClass("disabled warning").removeClass("message");a(".errorMessage")[0].style.cssText="";a(".errorMessage .content").text("Designer View is only available for projects with the Kendo UI Mobile or DataViz templates.")});p.bind("old_kendo",function(){window.designer.frameElement[0].src="about:blank";window.designer.codeManager.errors=true;a("#box").addClass("disabled warning").removeClass("message");a(".errorMessage").css({height:"140px",marginTop:"-70px"}).find(".content").text("Designer View is only available for projects with Kendo UI Mobile newer than Q1 2013 SP (2013.1.515).")});p.bind("select",function(q){window.designer.codeManager.selectById(q.id)});p.bind("delete",function(q){window.designer.navigator.remove(window.designer.navigator.select());window.designer.codeManager.remove(q.id)});p.bind("keypress",function(q){window.designer.trigger("keypress",q)});p.bind("tagged",function(q){var r=window.designer.navigator;if(r){var s=r.select();r.dataSource.data(q.tree);if(r.element.find(s)[0]){r.suppressSelection();r.select(s)}}else{q.tree[0].text="root";q.tree[0].id=null;window.designer.navigator=a("#navigator").kendoProjectNavigator({dataSource:q.tree}).data("kendoProjectNavigator")}})},events:["message","init"],options:{name:"FrameAdapter"},frameInfo:{},send:function(l){var n=this,m;setTimeout(function(){g.depth=0;try{m=JSON.stringify(l)}catch(o){m=JSON.stringify(l,g.censor)}n.element[0].contentWindow.postMessage(m,n.domain)},0)},getWidgetMarkup:function(s,r){var u=window.designer.widgets[s.toLowerCase()],o,t,q=u.mutations&&u.mutations[r]?u.mutations[r]:u.markup,n=u.exclusions&&u.exclusions[r]?u.exclusions[r].split(/\s*,\s*/):[],p=u.inclusions&&u.inclusions[r]?u.inclusions[r].split(/\s*[,\s]\s*/):false,l=" ";for(o in u.attributes){var m=u.attributes[o];if(m.value!==""&&m.value!==m["default"]&&n.indexOf(o)===-1){l+="data-"+o+'="'+m.value+'" '}}if(p){l+=p.join(" ")+" "}t=d.template(q,{useWithBlock:false})({attr:l.substr(0,l.length-1),text:s,children:u.children?d.template(u.children.markup,{useWithBlock:false})({template:d.template(u.attributes.template.value)(s)}):""});return{markup:t,hint:u.hint||t}},_initWidgets:function(){for(var o in window.designer.widgets){var r=window.designer.widgets[o],n=e[r.name].prototype.options,l={};for(var q in n){if(q!="prefix"){var p=q=="name",m=p?"role":q.toLowerCase();l[m]={value:p?n[q].toLowerCase():r.options?r.options[q]||n[q]:n[q],"default":p?"":n[q],type:typeof n[q]}}}window.designer.widgets[o].attributes=l}},_onMessage:function(l){var o=this,n,m;if(l.origin==o.domain||o.domain=="*"){n=JSON.parse(l.data)}for(m in n){o.trigger(m,n[m])}b(o.frameInfo,n);o.trigger("message",{data:l.data,origin:l.origin})}});h.plugin(c)})(jQuery);