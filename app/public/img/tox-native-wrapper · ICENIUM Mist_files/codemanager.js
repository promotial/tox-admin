(function(a,w){var i=window.kendo,v=i.ui,z=v.Widget,e=/\/>$/m,d=/<body[\s\S]*<\/body>/im,k=/\n<\/body>/im,u=/<(\w+?\b)[^<]*?>/gm,s=/<(\w+?\b)/gm,t=/<(\w+\b)[^<]*?\sdata-kendo-id=["']([\w\d]+?)["'][^<]*?>/gm,j=/\sdata-kendo-spot="[\w\d]+"/gm,l=/[\n\r]/gm,n=/</g,f=/>/g,o=/before|append/,c=/before|after/,r=/area|br|base|command|hr|img|input|keygen|link|meta|param|source|track|wbr/i,m=/(<(area|br|base|command|hr|img|input|keygen|link|meta|param|source|track|wbr)(\b[^<]*?[^\/]|\b))>/igm,b=/&/gm,q=/(<script[^>]*?>)[\s\S]*?(<\/script[^>]*?>)/igm,x=/<[^!\s]+?[^>]*?>/gm,y=/\s[^\s="']+?\b(?!=)([\s\/>])/gm;function p(A){return A.replace(n,"&lt;").replace(f,"&gt;")}function h(D,A){var E=a(D.documentElement).find("table");E.find("tr > td").parent().wrapAll("<tbody/>").end().find("tr > th").parent().wrapAll("<thead/>");var F=D.createTreeWalker(a(D.documentElement).children("body")[0],NodeFilter.SHOW_ELEMENT,null,false),B=A.createTreeWalker(A.body,NodeFilter.SHOW_ELEMENT,null,false);function C(L,H){var I=L.currentNode,G=H.currentNode,J,K=false;if(I){if(I.nodeName!=G.nodeName.toLowerCase()||I.parentNode.nodeName!=G.parentNode.nodeName.toLowerCase()||a(I).parents().length!=a(G).parents().length){J=(new XMLSerializer()).serializeToString(I);J=J.substr(-2)=="/>"?J.substr(0,J.indexOf(">")+1).replace("/>",">"):J;return{errors:true,errorMessage:"Invalid nesting detected - element <span>"+p(J)+"</span> is not allowed in the element at position <span>"+(G.position.row+1)+":"+G.position.col+"</span>"}}if(I.childElementCount){L.firstChild();H.firstChild();K=C(L,H)}if(!K){if(I.nextElementSibling){L.nextSibling();H.nextSibling();K=C(L,H)}else{L.parentNode();H.parentNode()}}}return K}return C(F,B)}var g=z.extend({init:function(A,B){var D=this,C;z.fn.init.call(D,A,B);A=D.element;D.designer=D.options.designer;D.lastWidgetId={};C=A.text();if(C&&C.trim()){D.feed(C)}D.reinit()},options:{name:"CodeManager",designer:{},indent:4},feed:function(A){var B=this;if(!B.comparable||(B.comparable&&B.comparable.trim()!=A.trim())){B.comparable=A;B.reinit();B.designer.scheduleUpdate()}},reinit:function(){var H=this,E,B=0,C,D,G=[],A,F={};if(!H.comparable){return false}H.document=H._initDocument(H.comparable);if(H.errors){H.cleanDoc=false;return false}H.cleanDoc=H._initDocument(H.comparable,true);H._markCode(null,true);H.comparable.replace(u,function(I,K,J){G.push({tag:K,offset:J-1,length:I.length});return I});A=H.comparable.toLowerCase();H.positions={};C=H.comparable.replace(d,H.document.body.outerHTML.replace(k,"</body>")).replace(s,function(I,K,J){E=G[B];if(E&&E.tag==K){F[J]={offset:E.offset,length:E.length};B++}return I});if(!H.errors){C.replace(t,function(M,P,Q,O){var T=H.getWidget(Q),N=F[O],K,J,S,R,L,I=T.getElementsByTagName(P);if(N){T.positionOffset=N.offset;T.position=H.calculatePosition(N.offset);if(r.test(P)){J=N.offset+N.length}else{K=I.length>0?I.length+1:1;J=N.offset+N.length-1;R=A.substr(J);S=new RegExp("<\\/"+P.toLowerCase()+"[^<]*?>|^\\/>","g");while(K--){L=S.exec(R)}if(L&&L[0]){T.closureLength=L[0].length}J+=S.lastIndex-1}T.closureOffset=J;T.closure=H.calculatePosition(J);T.openingLength=N.length}return M})}else{return false}D=h(H.errorDoc,H.document);if(D){a.extend(H,D);return false}return true},getContent:function(){var A=this.document;if(this.errors||!A){return""}return this._replaceComparable(A)},getCleanContent:function(){var A=this.cleanDoc;if(this.errors||!A){return""}return A.documentElement.innerHTML},hasErrors:function(){return this.errors},getWidget:function(A){return this.document.querySelector("[data-kendo-id="+A+"]")},getWidgetAtPos:function(H){H={row:H.line||H.row,col:H.ch||H.col};var J=this,D,F,G,E=1000000,A,I=false,C=false,B=J.document.querySelectorAll("[data-kendo-id]");if(B){for(D=0,F=B.length;D<F;D++){G=B[D].position;if(G){if(G.row==H.row&&!C){C=B[D]}A=H.col-G.col;if(G.row==H.row&&E>A&&A>=0){E=A;I=B[D]}}}}return I||C},selectWidget:function(B){var F=this,G,D,C,A,E;if(F.selectedWidget&&F.selectedWidget.element==B){F.designer.trigger("select",F.selectedWidget.position);return B}if(B){F.designer.navigator.suppressSelection();F.designer.navigator.selectById(B.dataset.kendoId);E=B.dataset[i.ns+"role"];if(!E){A=B;for(C=0;C<3;C++){A=A.parentNode;if(A&&A.dataset&&A.dataset[i.ns+"role"]){G=F.designer.syntheticRoles[A.dataset[i.ns+"role"]];break}}if(typeof G=="object"){if(B.nodeName=="INPUT"){G=(B.getAttribute("type")||"text").toLowerCase()}else{G=G[B.nodeName]}}}F.designer.inspector.scheduleInspect(B.outerHTML,G,B.dataset.kendoId);F.designer.adapter.send({select:{select:B.dataset.kendoId,role:E,id:B.dataset.id}});D={from:B.position,to:B.closure};F.designer.trigger("select",D);F.selectedWidget={element:B,position:D}}else{F.deselect()}return B},selectById:function(A){var B=this;if(B.errors||!B.document){return false}return B.selectWidget(B.getWidget(A))},selectAtPos:function(A){var B=this;if(B.errors||!B.document){return false}return B.selectWidget(B.getWidgetAtPos(A))},setAttribute:function(I,C,N){var L=this,H,M,B,A,G,E,F=L.getWidget(I),O,J,D,K;if(!F){return}K=L.comparable.substr(F.positionOffset+1,F.openingLength);if(C=="data-text"){a(F).text(N);a(F.reference).text(N);J=F.positionOffset+F.openingLength+1;D=F.closureOffset-F.closureLength+1;B=N;A="text"}else{E=e.test(K)?1:0;G=new RegExp("\\s"+C+'="([\\s\\S]*?)"',"im").exec(K)||{0:"",index:K.length-1-E};J=F.positionOffset+G.index+1;D=J+G[0].length;B=N===""?"":" "+C+'="'+N+'"';A="attribute";if(N===""){F.reference.removeAttribute(C);F.removeAttribute(C)}else{F.reference.setAttribute(C,N);F.setAttribute(C,N)}}H=L.calculatePosition(J-1);M=L.calculatePosition(D-1);L.comparable=L.comparable.substr(0,J)+B+L.comparable.substr(D);L.designer.suppressUpdate();L.designer.trigger("change",{from:H,to:M,code:B,action:A});L.findNewPosition(I);O=a(F).closest(i.roleSelector("view splitview modalview drawer"))[0];L.designer.adapter.send({attr:{id:I,name:C,value:N,content:O?O.outerHTML:a(F).closest(i.roleSelector("layout"))[0].outerHTML,type:O?"view":"layout"}})},remove:function(D){var K=this,E,C=K.getWidget(D);if(!C){return}var I=C.position,A=C.closure,H=C.positionOffset,B=C.closureOffset+1,J=a(C).prev()[0],G=a(C).next()[0],F=G&&G.dataset?G.dataset.kendoId:J&&J.dataset?J.dataset.kendoId:C.parentNode.dataset?C.parentNode.dataset.kendoId:"";C.reference.remove();C.remove();E=K._getIdPairs();K.comparable=K.comparable.substr(0,H)+K.comparable.substr(B);K.reinit();K.designer.suppressUpdate();K.designer.inspector.clear();K.designer.trigger("change",{from:I,to:A,code:"",action:"delete"});K.designer.adapter.send({remark:{id:F,items:E,type:"delete"}})},deselect:function(){var A=this;A.designer.adapter.send({deselect:true});A.designer.inspector.inspect()},getPosition:function(A){return this.getWidget(A).position},calculatePosition:function(C){if(!this.comparable.length){return{row:0,col:0}}var E=this,B=E.comparable.substr(0,C).match(l),D=B?B.length:0,A=C;for(;A>=0;A--){if(l.test(E.comparable[A])){return{row:D,col:C-A}}}return{row:D,col:0}},findNewPosition:function(B){var D=this,A,C;D.reinit();D.comparable=D.comparable.replace(j,"");A=D.document.querySelector("[data-kendo-spot="+B+"]");if(A){C=A.dataset.kendoId;D.reinit()}return D.getWidget(C)},insertCode:function(C,O){var P=this,F,D,G,E=O.id,K,J,N=P.getWidget(C.ref);if(!N){return}var L=c.test(C.action)?0:P.options.indent,M=new Array(L+1).join(" "),Q=N.position.col,I=new Array(Q+1).join(" "),H=O.markup.replace(/\n/g,"\n"+I+M),A=o.test(C.action),B=A?M+H+"\n"+I:"\n"+I+H+M;if(L&&P.comparable.substr(N.positionOffset,N.closureOffset-N.positionOffset).indexOf("\n")==-1){if(C.action=="append"){B="\n"+I+B}else{B=B[0]+M+B.substr(1)+"\n"+I}}G=B.replace(/(<\w+)/,'$1 data-kendo-spot="'+E+'"');switch(C.action){case"before":J=N.positionOffset+1;break;case"prepend":J=N.positionOffset+N.openingLength+1;break;case"append":J=N.closureOffset-N.closureLength+1;break;case"after":J=N.closureOffset+1;break}P.comparable=P.comparable.substr(0,J)+G+P.comparable.substr(J);a(N)[C.action](C.markup);F=P._getIdPairs();D=P.findNewPosition(E);if(D){K=P.calculatePosition(J-1);P.designer.trigger("change",{from:K,to:K,code:B,action:C.action});return{remark:{id:D.dataset.kendoId,items:F,type:"insert"}}}return false},_replaceComparable:function(A){return this.comparable.replace(d,A.body.outerHTML.replace(k,"</body>"))},_getIdPairs:function(B){var G=this,F=[],D={},A=G.document,E,C=A.createNodeIterator(B||A.documentElement,NodeFilter.SHOW_ELEMENT,null,false);while((E=C.nextNode())!==null){if(E&&E.dataset.kendoId){var H=G.getWidgetId(E.nodeName,D,E.dataset.role=="layout"||E.dataset.kendoId.indexOf("_layout")!==-1||(E.parentNode.dataset?E.parentNode.dataset.kendoId.indexOf("_layout")!==-1:false)||(E.parentNode.parentNode&&E.parentNode.parentNode.dataset?E.parentNode.parentNode.dataset.kendoId.indexOf("_layout")!==-1:false));F.push({old:E.dataset.kendoId,newId:H})}}return F},getWidgetId:function(C,B,A){var D=this;C=C.toLowerCase();B=B||D.lastWidgetId;if(!B[C]&&isNaN(B[C])){B[C]=0}return C+(B[C]++)+(A?"_layout":"")},_markCode:function(I,B,H,D){var L=this,J,E,A=function(){this.kendoInLayout=true},G=H||L.document,K,F,C=D||L.cleanDoc;if(B){L.lastWidgetId={};a(G.querySelectorAll("[data-kendo-id]")).each(function(){this.dataset.kendoId=null})}J=G.createNodeIterator(I||G.documentElement,NodeFilter.SHOW_ELEMENT,null,false),E=G.createNodeIterator(I||C.documentElement,NodeFilter.SHOW_ELEMENT,null,false);while((K=J.nextNode())!==null){F=E.nextNode();if(K&&!K.dataset.kendoId){if(K.getAttribute(i.attr("role"))=="layout"){a(K).find("*").addBack().each(A)}K.dataset.kendoId=L.getWidgetId(K.nodeName.toLowerCase(),false,K.kendoInLayout);F.kendoId=K.dataset.kendoId;K.reference=F}}},_initDocument:function(G,J){var K=this,E,B=[],D=[],F,H,A,I;if(!G){K.errors=true;return false}K.errors=false;if(!J){K.errorDoc=null;K.parser=new DOMParser();try{K.errorDoc=K.parser.parseFromString(G.replace(b,"").replace(q,"$1$2").replace(m,"$1/>").replace(x,function(L){L=L.replace(y,"$1");return L}),"text/xml")}catch(C){K.errors=true}if(K.errorDoc){I=K.errorDoc.querySelector("parsererror");if(I){K.errors=!!I;K.errorMessage=a(I).find("h3~div:eq(0)").text();if(K.errorMessage){K.errorMessage=K.errorMessage[0].toUpperCase()+K.errorMessage.substr(1)}}else{B=K.errorDoc.querySelectorAll("html > *");D=K.errorDoc.querySelectorAll("head > *:not(title)")}}if(K.errors){return false}}A=K.parser.parseFromString(G,"text/html");if(!J){E=A.querySelectorAll("head > *:not(title)").length!=D.length;if(E||A.querySelectorAll("html > *").length!=B.length){K.errors=true;if(E){K.errorMessage="Invalid children of the <span>&lt;head&gt;</span> tag detected!"}else{K.errorMessage="Invalid children of the <span>&lt;html&gt;</span> tag detected!"}}H=A.getElementsByTagName("*");for(F=H.length-1;F>=0;F--){if(H[F] instanceof window.HTMLUnknownElement){K.errorMessage="Unknown HTML5 element found: <span>"+H[F].outerHTML+"</span>!";K.errors=true;break}}if(K.errors){return false}}return A}});v.plugin(g)})(jQuery);