define(function(f){var e=f("kendo"),g=f("modules/version-control/sample-provider-service");var c=e.Observable.extend({id:"git",info:"Git",requireLogin:false,REMOTE_LOCK_STATE_UNKNOWN:"unknown",REMOTE_LOCK_STATE_PUBLIC:"public",REMOTE_LOCK_STATE_PRIVATE:"private",GITHUB_REGEX:"^\\s*(https:|http:|git:)//([A-Za-z0-9.@]+)(:|/)([_A-Za-z0-9/@]+)(.git)?\\s*$",init:function(){var i=this;e.Observable.fn.init.apply(i,arguments);i.type="git"},isUrlMatch:function(k){var j=this,i=new RegExp(j.GITHUB_REGEX,"i");return i.test(k)},checkIsLocked:function(j){var i=new $.Deferred();i.reject("none");return i.promise()},cloneRepoNeedsAuthentication:function(i){return this.pullRepoNeedsAuthentication(i)},pullRepoNeedsAuthentication:function(i){return $.ajax(this._getAuthenticationRequestSettings(i,"git-upload-pack"))},pushRepoNeedsAuthentication:function(i){return $.ajax(this._getAuthenticationRequestSettings(i,"git-receive-pack"))},_getAuthenticationRequestSettings:function(j,i){return{url:serviceConfiguration.backendServiceScheme+"://"+window.location.host+"/Mist/GitAuthentication.aspx/IsRequired",contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:'{"uri":"'+j+"/info/refs?service="+i+'"}'}}});var h=c.extend({id:"sample",info:"Icenium samples",init:function(){var i=this;e.Observable.fn.init.apply(i,arguments)},isUrlMatch:function(i){return g.isUrlMatch(i)},checkIsLocked:function(k){var j=this,i=new $.Deferred();j.getRepoList().done(function(m){if(m&&m.length){for(var n=0,o=m.length;n<o;n++){if(m[n].remoteUrl===k){i.resolve(j.REMOTE_LOCK_STATE_PUBLIC)}}i.resolve(j.REMOTE_LOCK_STATE_PRIVATE)}i.resolve(j.REMOTE_LOCK_STATE_PUBLIC)}).fail(function(){i.reject("Can not reach samples repositories")});return i.promise()},getRepoList:function(){return g.getAllSamples()}});var b=c.extend({REPO_INFO:"https://api.github.com/repos",USER_REPOS_ENDPOINT:"https://api.github.com/user/repos",GITHUB_URL_PARSE:"^\\s*(git:\\/\\/github\\.com\\/|https:\\/\\/github\\.com\\/|git@github\\.com:)(.+)\\/(.+?)(\\.git|)\\s*$",GITHUB_LOCK_FLAG:"private",id:"github",info:"GitHub",requireLogin:true,init:function(){var i=this;e.Observable.fn.init.apply(i,arguments)},isUrlMatch:function(j){var i=new RegExp(this.GITHUB_URL_PARSE,"i");return j.match(i)},checkIsLocked:function(p){var o=this,i=new $.Deferred(),l=new RegExp(o.GITHUB_URL_PARSE,"i"),j=p.match(l),k=j[2],n=j[3];$.ajax({url:[o.REPO_INFO,k,n].join("/"),dataType:"jsonp"}).done(function(m){if(m&&m.data&&m.data[o.GITHUB_LOCK_FLAG]===false){i.resolve(o.REMOTE_LOCK_STATE_PUBLIC)}else{i.resolve(o.REMOTE_LOCK_STATE_PRIVATE)}}).fail(function(m){i.reject(m.statusText)});return i.promise()},getRepoList:function(){var j=this,i=new $.Deferred();$.ajax({url:j.USER_REPOS_ENDPOINT,type:"GET",dataType:"jsonp"}).done(function(o){var p=[];if(o&&o.data&&o.data.length){for(var k=0,m=o.data.length;k<m;k++){var n=o.data[k];if(j.isUrlMatch(n.clone_url)){p.push({remoteId:j.id,name:n.name,description:n.description,remoteUrl:n.clone_url})}}p.sort(function(l,q){return(l.name.localeCompare(q.name))});i.resolve(p)}i.reject(o.data.message)}).fail(function(k){i.reject("Failed to retreve user repo list.")});return i.promise()}});var a=c.extend({REPO_INFO:"https://api.bitbucket.org/1.0/repositories",MATCH_URL_REGEX:"^\\s*https:\\/\\/[\\w-]*?@?bitbucket.org\\/(.+)\\/(.+?)(\\.git|)\\s*$",id:"bitbucket",info:"Bitbucket",init:function(){var i=this;e.Observable.fn.init.apply(i,arguments)},isUrlMatch:function(j){var i=new RegExp(this.MATCH_URL_REGEX,"i");return j.match(i)},checkIsLocked:function(p){var o=this,i=new $.Deferred(),l=new RegExp(this.MATCH_URL_REGEX,"i"),j=p.match(l),k=j[1],n=j[2];$.ajax({url:[o.REPO_INFO,k,n].join("/"),dataType:"jsonp",timeout:3000}).done(function(m){if(m&&m.is_private===false){i.resolve(o.REMOTE_LOCK_STATE_PUBLIC)}else{i.resolve(o.REMOTE_LOCK_STATE_PRIVATE)}}).fail(function(m){if(m.statusText==="timeout"||m.statusText==="success"){i.resolve(o.REMOTE_LOCK_STATE_PRIVATE)}else{i.reject(m.statusText)}});return i.promise()}});var d=e.Observable.extend({init:function(i){var j=this;e.Observable.fn.init.apply(j,arguments);j.providerCheckList=[];j.gitSamples=new h(g);j.gitBitbucket=new a();j.gitHub=new b();j.git=new c();j.providerCheckList.push(j.gitSamples);j.providerCheckList.push(j.gitHub);j.providerCheckList.push(j.gitBitbucket);j.providerCheckList.push(j.git)},getProviderByUrl:function(o){var n=this;if(o===undefined||o===null){o=""}for(var j=0,k=n.providerCheckList.length;j<k;j++){var m=n.providerCheckList[j];if(m.isUrlMatch(o)){return m}}return null}});return new d(g)});